package org.eclipse.regexp.ui.view.input;

import org.eclipse.jface.layout.GridDataFactory;
import org.eclipse.swt.SWT;
import org.eclipse.swt.layout.GridData;
import org.eclipse.swt.widgets.Composite;
import org.eclipse.swt.widgets.Control;
import org.eclipse.swt.widgets.Label;
import org.eclipse.swt.widgets.Text;
import org.eclipse.ui.ISharedImages;
import org.eclipse.ui.PlatformUI;
import org.eclipse.ui.forms.events.HyperlinkEvent;
import org.eclipse.ui.forms.events.IHyperlinkListener;
import org.eclipse.ui.forms.widgets.FormToolkit;
import org.eclipse.ui.forms.widgets.ImageHyperlink;

public class InputControl implements IHyperlinkListener {

	public Label label;
	private Text input;
	private ImageHyperlink hideBtn;

	private final InputSection inputSection;

	public InputControl(final InputSection inputSection) {
		this.inputSection = inputSection;
	}

	public void create(final Composite composite, final FormToolkit toolkit,
			final int index) {
		label = toolkit.createLabel(composite, "");
		GridDataFactory.swtDefaults().align(SWT.LEFT, SWT.CENTER)
				.applyTo(label);

		input = toolkit.createText(composite, "", SWT.SINGLE);
		GridDataFactory.swtDefaults().align(SWT.FILL, SWT.CENTER)
				.grab(true, false).applyTo(input);

		hideBtn = toolkit.createImageHyperlink(composite, SWT.NONE);
		hideBtn.setImage(PlatformUI.getWorkbench().getSharedImages()
				.getImage(ISharedImages.IMG_ETOOL_DELETE));
		hideBtn.addHyperlinkListener(this);

		refresh(index);
	}

	public void hide() {
		doHide(label);
		doHide(input);
		doHide(hideBtn);
	}

	public void refresh(final int index) {
		label.setText("Input " + index + ":");
	}

	private void doHide(final Control control) {
		final GridData data = (GridData) control.getLayoutData();
		data.exclude = true;
		control.setVisible(false);
		inputSection.removeInput(this);
		inputSection.refresh();
	}

	@Override
	public void linkEntered(final HyperlinkEvent e) {
	}

	@Override
	public void linkExited(final HyperlinkEvent e) {
	}

	@Override
	public void linkActivated(final HyperlinkEvent e) {
		hide();
	}
}